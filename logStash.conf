input {
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/rss/une.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/rss/en_continu.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/international/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/europe/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/afrique/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/asie-pacifique/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/etats-unis/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/economie/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/entreprises/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/argent/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/economie-francaise/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/industrie/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/emploi/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/immobilier/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lemonde.fr/medias/rss_full.xml"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/UNIVERS#_ga=2.8630962.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/UNIVERS_WFRA#_ga=2.8630962.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/WMON-EUR#_ga=2.8630962.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/UNIVERS_WMON#_ga=2.8630962.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/UNIVERS_WECO#_ga=2.8630962.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/UNIVERS_WFRA#_ga=2.49992225.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/WECO-ENT#_ga=2.49992225.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/UNIVERS_WECO#_ga=2.49992225.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/WECO-FRA#_ga=2.49992225.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "https://www.la-croix.com/RSS/WECO-MON#_ga=2.49992225.609153604.1570726032-1280687136.1570726031"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/economie/rss.xml"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/faits-divers/rss.xml"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/international/rss.xml"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/laparisienne/rss.xml"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/societe/rss.xml"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/sports/rss.xml"
	}
	rss {
		interval => 3600
		url => "http://www.leparisien.fr/high-tech/rss.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/rss_politique_societe.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/rss_france.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/Echos_monde.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/rss_tech_medias.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/rss_industries_services.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/rss_finance-marches.xml"
	}
	rss {
		interval => 3600
		url => "https://syndication.lesechos.fr/rss/rss_pme-innovation.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lexpress.fr/rss/emploi.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lexpress.fr/rss/enquete.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lexpress.fr/rss/medias.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lexpress.fr/rss/monde.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lexpress.fr/rss/opinions.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lexpress.fr/rss/politique.xml"
	}
	rss {
		interval => 3600
		url => "https://www.alternatives-economiques.fr/rss.xml"
	}
	rss {
		interval => 3600
		url => "https://lexpansion.lexpress.fr/rss/economie.xml"
	}
	rss {
		interval => 3600
		url => "https://lexpansion.lexpress.fr/rss/entreprise.xml"
	}
	rss {
		interval => 3600
		url => "https://lexpansion.lexpress.fr/rss/lexpansion.xml"
	}
	rss {
		interval => 3600
		url => "https://lexpansion.lexpress.fr/rss/high-tech.xml"
	}
	rss {
		interval => 3600
		url => "https://www.agefi.fr/rss.xml"
	}
	rss {
		interval => 3600
		url => "https://www.usinenouvelle.com/rss/"
	}
	rss {
		interval => 3600
		url => "https://feed.prismamediadigital.com/v1/cap/rss?sources=capital,polemik,xerfi,management,capital-avec-agence-france-presse,capital-avec-aof,capital-avec-reuters,capital-avec-optimaretraite,aeronewstv"
	}
	rss {
		interval => 3600
		url => "https://feed.prismamediadigital.com/v1/cap/rss?sources=capital,polemik,xerfi,capital-avec-agence-france-presse,capital-avec-aof,capital-avec-reuters,capital-avec-optimaretraite&categories=entreprises-marches"
	}
	rss {
		interval => 3600
		url => "https://www.alternatives-economiques.fr/rss.xml"
	}
	rss {
		interval => 3600
		url => "https://www.lejournaldesentreprises.com/rss-actualite-nationale"
	}
	rss {
		interval => 3600
		url => "https://www.lejournaldesentreprises.com/rss-all"
	}
	rss {
		interval => 3600
		url => "https://www.journaldunet.com/rss/"
	}
	rss {
		interval => 3600
		url => "https://www.lemoci.com/feed/?fsk=546086b7bc683"
	}
	rss {
		interval => 3600
		url => "https://bfmbusiness.bfmtv.com/rss/info/flux-rss/flux-toutes-les-actualites/"
	}
	rss {
		interval => 3600
		url => "https://bfmbusiness.bfmtv.com/rss/entreprise/"
	}
	rss {
		interval => 3600
		url => "https://www.francetvinfo.fr/france.rss"
	}
	rss {
		interval => 3600
		url => "https://www.francetvinfo.fr/politique.rss"
	}
}
filter {
	if ![link]{ #If the link field is not present in the rss input drop the event.
		drop {}
	}
	else{
		fingerprint{ # Compute a finger print of the article so that we don't duplicate it later.
			source => "link"
			method => "MD5"
			target => "[@metadata][fingerprint]"
		}
		ruby{
			# Here we recover the atricle's link and call a python
			# script to scrap the article.
			code => '
				require "open3"
				url = "\'" + event.get("link") + "\'"
				cmd = "python3 /home/scraper.py " + url
				stdin, stdout, stderr = Open3.popen3(cmd)
				if stderr.read.to_s.strip.empty?
					event.set("full_text", stdout.read)
				end
			'
		}

		if ![full_text]{ # If we could not scrap the article we drop the event.
			drop { }
		}
		mutate{
			remove_field => ["Feed"]
		}


	}

}

output {
	elasticsearch{
		hosts => "localhost:9200"
		document_id => "%{[@metadata][fingerprint]}" # Store the signature as an ID so that we won't have duplicates
		index => "articles" # Put articles in this specific index
	}
}
