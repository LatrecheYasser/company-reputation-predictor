input {
    
    rss{
        interval=> 90
        url=> "http://disparitus.blogspot.com/feeds/posts/default?alt=rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds2.feedburner.com/AvecNosGueules"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds.feedburner.com/exprimeoblog"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds.feedburner.com/KoztoujoursTuMintresses"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds.feedburner.com/paperblog/une"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds.feedburner.com/politique-net"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds.feedburner.com/RepublicainLorrain/Accueil"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://feeds.feedburner.com/sarkofrance"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://h16free.com/feed"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://heresie.hautetfort.com/index.rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://jen-airienadireetalors.20minutes-blogs.fr/index.rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://melanine.org/spip.php?page=backend"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://ruminances.unblog.fr/feed/"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://sarkobasta.blogspot.com/feeds/posts/default?alt=rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://uniqueetcommun.blogspot.com/feeds/posts/default?alt=rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://vivelefeu.20minutes-blogs.fr/index.rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://www.alterinfo.net/xml/syndication.rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://www.avmaroc.com/rss.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://www.bahbycc.com/feeds/posts/default?alt=rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://www.fdesouche.com/feed"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "http://www.slate.fr/rss.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.leprogres.fr/rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.leprogres.fr/economie/rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.usinenouvelle.com/rss/l-usine-auto/"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.usinenouvelle.com/rss/"
        type=> "rss"
    }
       rss{
        interval=> 90
        url=> "https://feed.prismamediadigital.com/v1/cap/rss?sources=capital,polemik,xerfi,management,capital-avec-agence-france-presse,capital-avec-aof,capital-avec-reuters,capital-avec-optimaretraite,aeronewstv"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://feed.prismamediadigital.com/v1/cap/rss?sources=capital,polemik,xerfi,capital-avec-agence-france-presse,capital-avec-aof,capital-avec-reuters,capital-avec-optimaretraite&categories=entreprises-marches"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lexpress.fr/rss/emploi.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lexpress.fr/rss/enquete.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lexpress.fr/rss/monde.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lexpress.fr/rss/politique.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://lexpansion.lexpress.fr/rss/entreprise.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://lexpansion.lexpress.fr/rss/high-tech.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.ledauphine.com/rhone/lyon/rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lyonplus.com/rss"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lejournaldesentreprises.com/rss-actualite-nationale"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lejournaldesentreprises.com/rss-all"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.journaldunet.com/rss/"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://bfmbusiness.bfmtv.com/rss/info/flux-rss/flux-toutes-les-actualites/"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://bfmbusiness.bfmtv.com/rss/entreprise/"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/rss/une.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/rss/en_continu.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/international/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/europe/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/afrique/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/asie-pacifique/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/etats-unis/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/economie/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/entreprises/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/argent/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/economie-francaise/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/industrie/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/emploi/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/immobilier/rss_full.xml"
        type=> "rss"
    }
    rss{
        interval=> 90
        url=> "https://www.lemonde.fr/medias/rss_full.xml"
        type=> "rss"
    }
}
filter {
	if ![link]{ #If the link field is not present in the rss input drop the event.
		drop {}
	}
	else{
		fingerprint{ # Compute a finger print of the article so that we don't duplicate it later.
			source => "link"
			method => "MD5"
			target => "[@metadata][fingerprint]"
		}
		ruby{
			# Here we recover the atricle's link and call a python
			# script to scrap the article.
			code => '
				require "open3"
				url = "\'" + event.get("link") + "\'"
				cmd = "python3 /home/scraper.py " + url
				stdin, stdout, stderr = Open3.popen3(cmd)
				if stderr.read.to_s.strip.empty?
					event.set("full_text",stdout.read)
				end
			'
		}

		if ![full_text]{ # If we could not scrap the article we drop the event.
			drop { }
		}
		mutate{
			# we delete the "Feed""@timestamp""@version" fields because we don't usee them and message to avoid duplication ful_ltext == message
			remove_field => ["@timestamp","@version","message"]
		}

		
	}
	
}

output {
	elasticsearch{
		hosts => "localhost:9200"
		document_id => "%{[@metadata][fingerprint]}" # Store the signature as an ID so that we won't have duplicates
		index => "articles" # Put articles in this specific index
	}
}
